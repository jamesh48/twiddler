<!DOCTYPE html>
<html>
  <head>
    <link rel='stylesheet' href='styles.css'>
    <script src="jquery.js"></script>
    <script src="dataGenerator.js"></script>
  </head>
  <body>
    <script>

      let dateHandler = function (weekDay, month, date, year, time) {
        let dateString = '';
        if (weekDay === 0) {
          dateString += 'Sun, ';
        } else if (weekDay === 1) {
          dateString += 'Mon, ';
        } else if (weekDay === 2) {
          dateString += 'Tues, ';
        } else if (weekDay === 3) {
          dateString += 'Wed, ';
        } else if (weekDay === 4) {
          dateString +=  'Thurs, ';
        } else if (weekDay === 5) {
          dateString += 'Fri, ';
        } else if (weekDay === 6) {
          dateString += 'Sat, ';
        } else if (weekDay === 7) {
          dateString += 'Sun, '
        } else {
          alert('weekday value not valid');
        }

        if (month === 0) {
          dateString += 'Jan ';
        } else if (month === 1) {
          dateString += 'Feb ';
        } else if (month === 2) {
          dateString += 'Mar ';
        } else if (month === 3) {
          dateString += 'April ';
        } else if (month === 4) {
          dateString += 'May ';
        } else if (month === 5) {
          dateString += 'June ';
        } else if (month === 6) {
          dateString += 'July ';
        } else if (month === 7) {
          dateString += 'August ';
        } else if (month === 8) {
          dateString += 'Sept ';
        } else if (month === 9) {
          dateString += 'Oct ';
        } else if (month === 10) {
          dateString += 'Nov ';
        } else if (month === 11) {
          dateString += 'Dec ';
        } else {
          alert('month value is not valid');
        }

        dateString += (date + ', ' + year + ' || ' + time);

        return dateString;

      }

            //Makes links clickable-
      $('a').on('click', function() {
        let handle = (event.target.innerHTML).split('');
        handle = handle.slice(0, handle.length - 2);
        handle.shift();
        let userHandle = handle.join('');
        $('.sortedNameDeclarations').removeClass('js-is-displayed')
        $('.' + userHandle).addClass('js-is-displayed');
      });


      $(document).ready(function(){
        let $body = $('body');
        $body.html('');

        let $tweetno11;

        const stylizeTweet = function(user, message, time) {
            //Stylized User
            let $user = $('<a></a>').text(user).attr('class', 'tweet-handle').addClass('zero-margin');

            //Stylized Message
            let $message = $('<p></p>').text(message).attr('class', 'tweet-timeline-message').addClass('zero-margin');

            //Stylized Time
            let $time = $('<p></p>').text(time).attr('class', 'tweet-time').addClass('zero-margin');

            let $stylizedTweet = $($user.add($message).add($time));
            return $stylizedTweet;
        }

        let $oneMoreTweetBtn = $('<button></button>').text('More Tweets!').on('click', function() {
          generateRandomTweet();
          if (!$tweetno11) {
            //Add new html
            $tweetno11 = $('<div></div>').attr({'class': 'tweet-container', 'id': 'tweetno11'});
            $($tweetno11).appendTo($tweetTimeline)
            //tweetno10 borderbottom
            $('#tweetno10').css('border-bottom', 'none')
          }

          //This part introduces a new tweet and moves all the tweets down in the stack-
            let saverArray =[];
            for (let i = 0; i <= 11; i++) {
              let tweet = streams.home[streams.home.length - 1];

              let user = $('#tweetno' + i).children('a.tweet-handle').text();
              let message = $('#tweetno' + i).children('p.tweet-timeline-message').text();

              let $time = $('#tweetno' + i).children('p.tweet-time').text();

              saverArray.push(stylizeTweet(user, message, $time));


          if (i === 0) {
            //Handling the Time for new Tweet~
            let d = tweet.created_at;
            let time = d.toLocaleTimeString();
            let year = d.getFullYear();
            let month = d.getMonth();
            let date = d.getDate();
            let weekDay = d.getDay();
            let fullDate = dateHandler(weekDay, month, date, year, time);

            $('#tweetno' + i).html(stylizeTweet('@' + tweet.user + ': ', tweet.message, fullDate));
              } else {
                $('#tweetno' + i).html(saverArray[i - 1]);
              }
          }

      //Makes links clickable-
      $('a').on('click', function() {
        let handle = (event.target.innerHTML).split('');
        handle = handle.slice(0, handle.length - 2);
        handle.shift();
        let userHandle = handle.join('');
        $('.sortedNameDeclarations').removeClass('js-is-displayed')
        $('.' + userHandle).addClass('js-is-displayed');
      });

      }).appendTo($body);

      //The basic Tweet Timeline
        let $tweetTimeline = $('<div></div>').addClass('test-border-one').attr('class', 'tweet-timeline');
        let $tweetTimelineTitle = $('<h3></h3>').text('Tweet Timeline').attr('class', 'section-title')

        $tweetTimeline.append($tweetTimelineTitle);
        $tweetTimeline.appendTo($body);

        let index = 0;
        while(index < streams.home.length){
          let tweet = streams.home[index];
          //Handling the Time
          let d = tweet.created_at;
          let time = d.toLocaleTimeString();
          let year = d.getFullYear();
          let month = d.getMonth();
          let date = d.getDate();
          let weekDay = d.getDay();
          let fullDate = dateHandler(weekDay, month, date, year, time);


          //Tweet Container:
          let $tweet = $('<div></div>').html(stylizeTweet('@' + tweet.user +': ', tweet.message, fullDate)).attr({'class': 'tweet-container', 'id': 'tweetno' + index})

          $tweet.appendTo($tweetTimeline);
          index += 1;
        }

     //Line Break
     $('</br>').appendTo('body')











      //Sorted Section-----------
      let $sortedTweetsContainer = $('<div></div>')

      let $title = $('<h3></h3>').text('Sorted').addClass('js-is-underlined').attr('class', 'section-title');

      $title.appendTo($sortedTweetsContainer);

      for(let key in streams.users){

        let $currentSortedTweetDeck = $('<div></div>').addClass('margin test-border-one').attr({'class': 'sortedNameDeclarations ' + key});

        $($currentSortedTweetDeck).appendTo($sortedTweetsContainer);

        //Tweeters Name
        //these lines add the names:
        let $currentNameDeclaration = $('<h4></h4>').text(key).addClass('test-border-two').attr('class', 'currentNameDeclarations');

        $currentNameDeclaration.appendTo($currentSortedTweetDeck);

        let $currentTweetStack = $('<div></div>').css('margin-bottom', '20px');
        $currentTweetStack.appendTo($currentSortedTweetDeck);

        //------------------------
        //These lines add the tweets:
        for (let i = streams.users[key].length - 1; i >= 0; i--) {
          let currentTweet = JSON.stringify(streams.users[key][i].message);
          let $currentUserTweet = $('<p></p>').text(currentTweet).addClass('js-is-italicized');

          $currentUserTweet.appendTo($currentTweetStack);
        }
        //-------------------------

        $('</br>').appendTo($currentTweetStack);

      }




      $sortedTweetsContainer.appendTo($body)



      //Makes links clickable-
      $('a').on('click', function() {
        let handle = (event.target.innerHTML).split('');
        handle = handle.slice(0, handle.length - 2);
        handle.shift();
        let userHandle = handle.join('');
        $('.sortedNameDeclarations').removeClass('js-is-displayed')
        $('.' + userHandle).addClass('js-is-displayed');
      });

    });


    </script>
  </body>
</html>
