<!DOCTYPE html>
<html>
  <head>
    <link rel='stylesheet' href='styles.css'>
    <script src="jquery.js"></script>
    <script src="dataGenerator.js"></script>
  </head>
  <body>
    <script>

      let dateHandler = function (weekDay, month, date, year, time) {
        let dateString = '';
        if (weekDay === 0) {
          dateString += 'Sun, ';
        } else if (weekDay === 1) {
          dateString += 'Mon, ';
        } else if (weekDay === 2) {
          dateString += 'Tues, ';
        } else if (weekDay === 3) {
          dateString += 'Wed, ';
        } else if (weekDay === 4) {
          dateString +=  'Thurs, ';
        } else if (weekDay === 5) {
          dateString += 'Fri, ';
        } else if (weekDay === 6) {
          dateString += 'Sat, ';
        } else if (weekDay === 7) {
          dateString += 'Sun, '
        } else {
          alert('weekday value not valid');
        }

        if (month === 0) {
          dateString += 'Jan ';
        } else if (month === 1) {
          dateString += 'Feb ';
        } else if (month === 2) {
          dateString += 'Mar ';
        } else if (month === 3) {
          dateString += 'April ';
        } else if (month === 4) {
          dateString += 'May ';
        } else if (month === 5) {
          dateString += 'June ';
        } else if (month === 6) {
          dateString += 'July ';
        } else if (month === 7) {
          dateString += 'August ';
        } else if (month === 8) {
          dateString += 'Sept ';
        } else if (month === 9) {
          dateString += 'Oct ';
        } else if (month === 10) {
          dateString += 'Nov ';
        } else if (month === 11) {
          dateString += 'Dec ';
        } else {
          alert('month value is not valid');
        }

        dateString += (date + ', ' + year + ' || ' + time);

        return dateString;

      }

      //Setting up for Color Coding...
      let userArray = [];

      for (let key in streams.users) {
        for (let i = streams.users[key].length - 1; i >= 0; i--) {
          userArray.push(key);
        }
      }

      userArray = userArray.filter((item, index) => userArray.indexOf(item) === index);
      let colorObj = {};
      //ref: https://www.incengine.com/?name=Pastel-HTML-Color-Codes&art=pastel_colors
      let colorArray = ['#A5D3CA', '#67C7E2', '#9191FF', '#FFA4A4', '#A095EE', '#75B4FF', '#C87C5B', '#D73E68', '#8D18AB', '#5B5BFF', '#25A0C5', '#4A9586'];

      for (let i = colorArray.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * i);
        const temp = colorArray[i];
        colorArray[i] = colorArray[j];
        colorArray[j] = temp;
      }

      colorArray = colorArray.slice(0, userArray.length);

      for(let i = 0; i < userArray.length; i++) {
        colorObj[userArray[i]]= colorArray[i];
      }

      const colorCoding = function() {
          //Colors!
          for (let key in colorObj) {
              $('.inner-tweet-container.' + key).css('background-color', colorObj[key]);
            }

            $('.outer-tweet-container').css('background-color', 'darkslategray');
      }


      $(document).ready(function(){
        let $body = $('body');
        $body.html('');

        let $tweetno11;

        const stylizeTweet = function(user, message, time, index) {
            let userNameOnly = user.split('');
            userNameOnly = userNameOnly.splice(0, userNameOnly.length - 2);
            userNameOnly = userNameOnly.join('');

            //Stylized User
            let $user = $('<a></a>').text(user).attr('class', 'tweet-handle').addClass('zero-margin');

            //Stylized Message
            message = message.split('');
            if(message.indexOf('#') !== -1) {
              let hashHandle = message.splice(message.indexOf('#')).join('')
              let $hashHandle = $('<a></a>').attr('class', 'hash-handle').text(hashHandle);
              let messageSansHash = message.join('')
              message = $('<p></p>').attr('class', 'tweet-timeline-message').text(messageSansHash).add($hashHandle);
            } else {
              message = message.join('')
              message = $('<p></p>').text(message).attr('class', 'tweet-timeline-message');
            }
            //Stylized Time
            let $time = $('<p></p>').text(time).attr('class', 'tweet-time').addClass('zero-margin');

            let $unfortunateDiv = $('<div></div>').attr({'class': 'inner-tweet-container ' + userNameOnly, 'id': 'itc' + index});
            let $stylizedTweet = $($unfortunateDiv.append($user.add(message).add($time)));
            return $stylizedTweet;
        }


      //The basic Tweet Timeline
        let $tweetTimeline = $('<div></div>').addClass('test-border-one').attr('class', 'section-container');
        let $tweetTimelineTitle = $('<h3></h3>').text('Tweet Timeline').attr('class', 'section-title tweet-timeline-title');

        $tweetTimeline.append($tweetTimelineTitle);
        $tweetTimeline.appendTo($body);

        let index = 0;
        while(index <= streams.home.length){
          if (index === streams.home.length) {
            let $tweet = $('<div></div>').html(stylizeTweet('', '', '', index)).attr({'id': 'otc' + index, 'class': 'outer-tweet-container js-is-hidden'});
            $tweet.appendTo($tweetTimeline);
            break;
          }
          let tweet = streams.home[index];

          //Handling the Time
          let d = tweet.created_at;
          let time = d.toLocaleTimeString();
          let year = d.getFullYear();
          let month = d.getMonth();
          let date = d.getDate();
          let weekDay = d.getDay();
          let fullDate = dateHandler(weekDay, month, date, year, time);

          //Tweet Container:
          let $tweet = $('<div></div>').html(stylizeTweet(tweet.user +': ', tweet.message, fullDate, index)).attr({'id': 'otc' + index, 'class': 'outer-tweet-container ' + tweet.user});

          $tweet.appendTo($tweetTimeline);
          index += 1;
        }

//One More Tweet Button---
//-------------------
  let $oneMoreTweetBtn = $('<button></button>').text('More Tweets!').on('click', function() {
  $('#otc11').removeClass('js-is-hidden');
  generateRandomTweet();
    //Add new html

//This part introduces a new tweet and moves all the tweets down in the stack-
  let saverArray =[];
  let colorSaverArray = [];
  for (let i = 0; i <= 11; i++) {
    let tweet = streams.home[streams.home.length - 1];

    let user = $('#itc' + i).children('a.tweet-handle').text();

    let message = $('#itc' + i).children('p.tweet-timeline-message').text();

    let time = $('#itc' + i).children('p.tweet-time').text();

    saverArray.push(stylizeTweet(user, message, time));
    let currentColor =$('#itc' + i).css('background-color');
    colorSaverArray.push(currentColor);

    //The New Tweet
    if (i === 0) {
      //Handling the Time for new Tweet~
      let d = tweet.created_at;
      let time = d.toLocaleTimeString();
      let year = d.getFullYear();
      let month = d.getMonth();
      let date = d.getDate();
      let weekDay = d.getDay();
      let fullDate = dateHandler(weekDay, month, date, year, time);

      let $userHandle = $('<a></a>').text(tweet.user).attr('class', 'tweet-handle zero-margin');

      let $message = $('<p></p>').text(tweet.message).attr('class', 'tweet-timeline-message zero-margin');

      let $time = $('<p></p>').text(fullDate).attr('class', 'tweet-time zero-margin');

      let newTweet = $userHandle.add($message).add($time);

       $('#itc' + i).html(newTweet).css('background-color', colorObj[$userHandle.text()]);
    } else {
      //The rest of the Tweets------
      //prevHandle changes the class (for color purposes)
      let $userHandle = saverArray[i - 1].children('a.tweet-handle').html();
      let prevHandle = $userHandle.split('');
      prevHandle = prevHandle.splice(0, prevHandle.length - 2).join('');
      //---------

      $userHandle = $('<a></a>').text($userHandle).attr('class', 'tweet-handle zero-margin');

      let $message = $('<p></p>').text(saverArray[i - 1].children('p.tweet-timeline-message').text()).attr('class', 'tweet-timeline-message zero-margin');

      let $time = $('<p></p>').text(saverArray[i - 1].children('p.tweet-time').text()).attr('class', 'tweet-time zero-margin');
     let oldTweet = $userHandle.add($message).add($time);

     $('#itc' + i).html(oldTweet).css({'background-color': colorSaverArray[i - 1]});
  }

    //Clears the Sorted Tweet Stack;
    $('.current-tweet-stack').html('');
    //Then repopulates Sorted Tweet Stack with New Tweets.
    for (let key in streams.users) {
      for (let i = streams.users[key].length - 1; i >= 0; i--) {

        let tweet = streams.home[i];
          //Handling the Time
          let d = tweet.created_at;
          let time = d.toLocaleTimeString();
          let year = d.getFullYear();
          let month = d.getMonth();
          let date = d.getDate();
          let weekDay = d.getDay();
          let fullDate = dateHandler(weekDay, month, date, year, time);


        let currentTweet = JSON.stringify(streams.users[key][i].message);

        let $containerDiv = $('<div></div>').attr('class', 'sorted-individual-tweet-container')

        let $currentDate = $('<p></p>').attr('class', 'tweet-time').text(fullDate + ', ');

        let $currentUserTweet = $('<p></p>').attr('class', 'sorted-tweet-list-li').css('background-color', colorObj[streams.users[key][i].user]).text(key + ': ' + currentTweet);

        $currentDate.appendTo($containerDiv);
        $currentUserTweet.appendTo($containerDiv);
        $containerDiv.appendTo('#' + key + '-tweet-stack');
      }
    }
 }

      //Makes links clickable-
      $('a').on('click', function() {
        let userHandle = (event.target.innerHTML);
        userHandle = userHandle.split('');
        userHandle = userHandle.splice(0, userHandle.length - 2).join('');

        $('.sortedNameDeclarations').removeClass('js-is-displayed')
        $('.' + userHandle).addClass('js-is-displayed');

        $('#sorted-title').text('-- ' + userHandle + '\'s Sorted Timeline --').css({'color': '#FFFFFF', 'background-color': colorObj[userHandle]})

        $('#sorted-timeline').css({'background-color': colorObj[userHandle]});

        //Alpha Transparent Background!
        let alphaColor = colorObj[userHandle].split('');
        alphaColor.splice(alphaColor.length, 0, 'A6');
        alphaColor = alphaColor.join('');
        $('#sorted-timeline').css({'background-color': alphaColor});

      })
}).attr('class', 'one-more-tweet-button').appendTo($body);


colorCoding();

//Line Break
$('</br>').appendTo('body')

      //Sorted Section-----------
      const $sortedTweetsContainer = $('<div></div>').attr({'id': 'sorted-timeline', 'class': 'section-container sorted-timeline'});

      let $title = $('<h3></h3>').text('Sorted').addClass('js-is-underlined').attr({'class': 'section-title', 'id': 'sorted-title'}).appendTo($sortedTweetsContainer);

      for(let key in streams.users){
        let $currentSortedTweetDeck = $('<div></div>').addClass('test-border-one').attr({'class': 'sortedNameDeclarations ' + key});

        $($currentSortedTweetDeck).appendTo($sortedTweetsContainer);

        //Tweeters Name
        //these lines add the names:


        let $currentTweetStack = $('<div></div>').attr({'id': key + '-tweet-stack', 'class': 'current-tweet-stack'});
        $currentTweetStack.appendTo($currentSortedTweetDeck);


        //------------------------

        //These lines add the tweets:
        for (let i = 0; i < streams.users[key].length; i++) {
          let tweet = streams.home[i];

          //Handling the Time
          let d = tweet.created_at;
          let time = d.toLocaleTimeString();
          let year = d.getFullYear();
          let month = d.getMonth();
          let date = d.getDate();
          let weekDay = d.getDay();
          let fullDate = dateHandler(weekDay, month, date, year, time);

          let currentTweet = streams.users[key][i].message;
          let containerDiv = $('<div></div>').attr('class', 'sorted-individual-tweet-container')
          let $currentUserTime = $('<p></p>').attr('class', 'tweet-time').text(fullDate + ', ')
          let $currentUserTweet = $('<p></p>').attr('class', 'sorted-tweet-list-li').css('background-color', colorObj[streams.users[key][i].user]).text(currentTweet).addClass('js-is-italicized');

          if (i === 0) {
            $($currentUserTweet).addClass('js-is-bolded')
          }
          $currentUserTime.appendTo(containerDiv);
          $currentUserTweet.appendTo(containerDiv);

          containerDiv.appendTo($currentTweetStack);
        }
        //-------------------------

        $('</br>').appendTo($currentTweetStack);

      }

      $sortedTweetsContainer.appendTo($body)

      //Makes links clickable-
      $('a').on('click', function() {
        let aTest = event.target.innerHTML.split('');
        if (aTest[0] === '#') {
          aTest = aTest.splice(1)
          aTest = aTest.join('');
          $('.hashtag-name-declarations').removeClass('js-is-displayed');
          $('.' + aTest).addClass('js-is-displayed');
          $('#hashtag-sorted-title').text('-- #' + aTest + ' --').css({'color': '#FFFFFF', 'background-color': 'salmon'});
          return;
        }
        let userHandle = (event.target.innerHTML);
        userHandle = userHandle.split('');
        userHandle = userHandle.splice(0, userHandle.length - 2).join('');

        $('.sortedNameDeclarations').removeClass('js-is-displayed');
        $('.' + userHandle).addClass('js-is-displayed');
        $('#sorted-title').text('-- ' + userHandle + '\'s Sorted Timeline --').css({'color': '#FFFFFF', 'background-color': colorObj[userHandle]})

        //Alpha Transparent Background!
        let alphaColor = colorObj[userHandle].split('');
        alphaColor.splice(alphaColor.length, 0, 'A6');
        alphaColor = alphaColor.join('');
        $('#sorted-timeline').css({'background-color': alphaColor});
      });

      //Hashtag Section-
      const $hashtagTweetsContainer = $('<div></div>').attr('class', 'section-container hashtag-tweets-container').appendTo('body');


      let $hashTagtitle = $('<h3></h3>').text('Hashtags Sorted').addClass('js-is-underlined').attr({'class': 'section-title', 'id': 'hashtag-sorted-title'}).appendTo($hashtagTweetsContainer);

      //This for loop creates hashtag containers
      for (let i = 0; i < tags.length; i++) {

      //Removing the hash for the id & class...
      let hashCheck = tags[i].split('');
        if (hashCheck[0] === '#') {
          hashCheck.shift()
          hashCheck = hashCheck.join('');
        } else {
          hashCheck = hashCheck.join('')
        }

        let $currentSortedHashtagDeck = $('<div></div>').attr('class','hashtag-name-declarations ' + hashCheck)

       $currentSortedHashtagDeck.appendTo($hashtagTweetsContainer);

       let $currentHashTagStack = $('<div></div>').attr({'id': hashCheck + '-hashtag-stack', 'class': 'current-hashtag-stack'}).appendTo($currentSortedHashtagDeck);

        for (let j = 0; j < streams.home.length; j++) {
          let checkTag = streams.home[j].message;
          checkTag = checkTag.split('');
          if (checkTag.indexOf('#') !== -1) {
            checkTag = checkTag.splice(checkTag.indexOf('#')).join('');
            if (tags[i] === checkTag) {
              $('<p></p>').text(streams.home[j].user + ': ' + streams.home[j].message).appendTo($currentHashTagStack);
            }
          }
        }
      }

      let coolButton = $('<button></button>').text('Test').on('click',
        function (){
          let test = $('.twit8').css('background-color');
          alert(JSON.stringify(test));

        }
      ).appendTo('body');
    });
    </script>
  </body>
</html>
