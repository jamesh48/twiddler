<!DOCTYPE html>
<html>
  <head>
    <link rel='stylesheet' href='styles.css'>
    <script src="jquery.js"></script>
    <script src="dataGenerator.js"></script>
  </head>
  <body>
    <script>

      let dateHandler = function (tweetDate) {

        let time = tweetDate.toLocaleTimeString();
        let year = tweetDate.getFullYear();
        let month = tweetDate.getMonth();
        let date = tweetDate.getDate();
        let weekDay = tweetDate.getDay();

        let dateString = '';
        if (weekDay === 0) {
          dateString += 'Sun, ';
        } else if (weekDay === 1) {
          dateString += 'Mon, ';
        } else if (weekDay === 2) {
          dateString += 'Tues, ';
        } else if (weekDay === 3) {
          dateString += 'Wed, ';
        } else if (weekDay === 4) {
          dateString +=  'Thurs, ';
        } else if (weekDay === 5) {
          dateString += 'Fri, ';
        } else if (weekDay === 6) {
          dateString += 'Sat, ';
        } else if (weekDay === 7) {
          dateString += 'Sun, '
        } else {
          alert('weekday value not valid');
        }

        if (month === 0) {
          dateString += 'Jan ';
        } else if (month === 1) {
          dateString += 'Feb ';
        } else if (month === 2) {
          dateString += 'Mar ';
        } else if (month === 3) {
          dateString += 'April ';
        } else if (month === 4) {
          dateString += 'May ';
        } else if (month === 5) {
          dateString += 'June ';
        } else if (month === 6) {
          dateString += 'July ';
        } else if (month === 7) {
          dateString += 'August ';
        } else if (month === 8) {
          dateString += 'Sept ';
        } else if (month === 9) {
          dateString += 'Oct ';
        } else if (month === 10) {
          dateString += 'Nov ';
        } else if (month === 11) {
          dateString += 'Dec ';
        } else {
          alert('month value is not valid');
        }

        dateString += (date + ', ' + year + ' || ' + time);

        return dateString;

      }

    //Setting up for Color Coding...
    let colorObj = {};
    //ref: https://www.incengine.com/?name=Pastel-HTML-Color-Codes&art=pastel_colors
    let colorArray = ['#A5D3CA', '#67C7E2', '#9191FF', '#FFA4A4', '#A095EE', '#75B4FF', '#C87C5B', '#D73E68', '#8D18AB', '#5B5BFF', '#25A0C5', '#4A9586'];

    for (let i = colorArray.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * i);
      const temp = colorArray[i];
      colorArray[i] = colorArray[j];
      colorArray[j] = temp;
    }

    colorArray = colorArray.slice(0, window.users.length);

    for(let i = 0; i < window.users.length; i++) {
      colorObj[window.users[i]]= colorArray[i];
    }

  //Colors!!
  const colorCoding = function() {
    for (let key in colorObj) {
        $('.inner-tweet-container.' + key).css('background-color', colorObj[key]);
      }
      $('.outer-tweet-container').css('background-color', 'darkslategray');
  }

  //Stylize Tweet
  const stylizeTweet = function(user, message, time, index) {
    let userNameOnly = user.split('');
    userNameOnly = userNameOnly.splice(0, userNameOnly.length - 2);
    userNameOnly = userNameOnly.join('');

    //Stylized User
    let $user = $('<a></a>').text(user).attr('class', 'tweet-handle').addClass('zero-margin');

    //Stylized Message
    message = message.split('');
      if(message.indexOf('#') !== -1) {
        let hashHandle = message.splice(message.indexOf('#')).join('')
        let $hashHandle = $('<a></a>').attr('class', 'hash-handle').text(hashHandle);
        let messageSansHash = message.join('')
        message = $('<p></p>').attr('class', 'tweet-timeline-message').text(messageSansHash).add($hashHandle);
      } else {
        message = message.join('')
        message = $('<p></p>').text(message).attr('class', 'tweet-timeline-message');
      }

    //Stylized Time
    let $time = $('<p></p>').text(time).attr('class', 'tweet-time').addClass('zero-margin');

    let $unfortunateDiv = $('<div></div>').attr({'class': 'inner-tweet-container ' + userNameOnly, 'id': 'itc' + index});
    let $stylizedTweet = $($unfortunateDiv.append($user.add(message).add($time)));
    return $stylizedTweet;
  }


  $(document).ready(function(){
    let $body = $('body');
    $body.html('');

    //The Initial Tweet Timeline Setup
    //Tweet Timeline Container
    let $tweetTimeline = $('<div></div>').attr({'id': 'tweet-timeline-container','class': 'section-container'}).appendTo('body')
    //Tweet Timeline Title.
    $('<h3></h3>').text('Tweet Timeline').attr('class', 'section-title tweet-timeline-title').appendTo($tweetTimeline)

    let index = 0;
    while (index <= streams.home.length) {
      if (index === streams.home.length) {
        //The 11th Tweet Container
        $('<div></div>').html(stylizeTweet('', '', '', index)).attr({'id': 'otc' + index, 'class': 'outer-tweet-container otc11'}).appendTo($tweetTimeline);
        break;
      }

    //Tweet Container:
    const accessTweet = streams.home[index];
    $('<div></div>').html(stylizeTweet(accessTweet.user +': ', accessTweet.message, dateHandler(accessTweet.created_at), index)).attr({'id': 'otc' + index, 'class': 'outer-tweet-container ' + accessTweet.user}).appendTo($tweetTimeline);
    index += 1;
    }

  //----One More Tweet Button----
  const $oneMoreTweetBtn = $('<button></button>').text('More Tweets!').on('click', function() {
  //Reveals Tweet Container 11...
  $('.otc11').addClass('js-is-displayed');

  //Generates a new Tweet.
  generateRandomTweet();

  //This part introduces a new tweet and moves all the tweets down in the stack-
  const saverArray =[];
  const colorSaverArray = [];
  for (let i = 0; i <= 11; i++) {
    let saveUser = $('#itc' + i).children('a.tweet-handle').text();
    let saveMessage = $('#itc' + i).children('p.tweet-timeline-message').text();
    let saveHash = $('#itc' + i).children('a.hash-handle').text();
    saveMessage = saveMessage + saveHash;
    let saveTime = $('#itc' + i).children('p.tweet-time').text();

    saverArray.push(stylizeTweet(saveUser, saveMessage, saveTime));

    const currentColor =$('#itc' + i).css('background-color');
    colorSaverArray.push(currentColor);

    //The New Tweet
    if (i === 0) {
      const newTweet = streams.home[streams.home.length - 1];

      //The User Handle for the new Tweet (no @ sign, but includes colon).
      let $userHandle = $('<a></a>').text(newTweet.user + ': ').attr('class', 'tweet-handle');
      //Handling the Time for new Tweet~
      //The Tweet Time:
      let $time = $('<p></p>').text(dateHandler(newTweet.created_at)).attr('class', 'tweet-time zero-margin');

      //New Tweet Message-
      let newTweetMessage = newTweet.message.split('');
        if (newTweetMessage.indexOf('#') !== -1) {
          let hashHandle = newTweetMessage.splice(newTweetMessage.indexOf('#')).join('')
          let $hashHandle = $('<a></a>').attr('class', 'hash-handle').text(hashHandle);
          newTweetMessage = $('<p></p>').attr('class', 'tweet-timeline-message').text(newTweetMessage.join('')).add($hashHandle);
        } else {
          newTweetMessage = $('<p></p>').text(newTweetMessage.join('')).attr('class', 'tweet-timeline-message');
        }
      //Declaring the New Tweet.
      const finalNewTweet = $userHandle.add(newTweetMessage).add($time);
      //These lines remove the colon from the user handle so that the background color in colorObj can be accessed.
      let removeColon = $userHandle.text().split('');
      removeColon = removeColon.splice(0, removeColon.length - 2);
      $userHandle = removeColon.join('');
      //Finally the new Tweet is introduced
       $('#itc0').html(finalNewTweet).css('background-color', colorObj[$userHandle]);
    } else {
      //The rest of the tweets (itc2 - itc11)
      //The Previous User Handle
      let coolHandle = saverArray[i - 1].children('a.tweet-handle').text();
      let coolMessage = saverArray[i - 1].children('p.tweet-timeline-message').text();
      let coolHash = saverArray[i - 1].children('a.hash-handle').text();
      coolMessage = coolMessage + coolHash;

      let coolTime = saverArray[i - 1].children('p.tweet-time').text();

      $('#itc' + i).html(stylizeTweet(coolHandle, coolMessage, coolTime).html()).css({'background-color': colorSaverArray[i - 1]});
     }
   }

   //Clears the HashTag Tweet Stack
   $('.current-hashtag-stack').html('');
    //Clears the Sorted Tweet Stack;
    $('.current-tweet-stack').html('');
    //Then repopulates Sorted Tweet Stack with New Tweets.
      for (let i = streams.home.length - 1; i >= 0; i--) {
        let tweet = streams.home[i];

        //Handling the Time for Sorted Timeline Ind tweet
        let fullDate = dateHandler(tweet.created_at);

        let currentTweet = tweet.message;
        //For hashtag-stack
        let hashCheck = currentTweet.split('');
        if (hashCheck.indexOf('#') !== -1) {
          hashCheck = hashCheck.splice(hashCheck.indexOf('#') + 1);
          hashCheck = hashCheck.join('');
          let $containerDiv = $('<div></div>').attr('class', 'sorted-individual-tag-container');

          let $currentDate = $('<p></p>').attr('class', 'tweet-time').text(fullDate + ', ').addClass('js-is-underlined').appendTo($containerDiv);

          let $currentUserTweet = $('<p></p>').attr('class', 'sorted-tag-list-li').text(tweet.user + ': ' + tweet.message).css('background-color', colorObj[tweet.user]).appendTo($containerDiv)

          $containerDiv.appendTo('#' + hashCheck + '-hashtag-stack');

          let $hashTagStackChildren = $('#' + hashCheck + '-hashtag-stack').children();

          if ($hashTagStackChildren.length > 5) {
            $hashTagStackChildren.eq($hashTagStackChildren.length - 1).remove();
          }
        }

        //For Sorted Tweet Stack;
        let $containerDiv = $('<div></div>').attr('class', 'sorted-individual-tweet-container')

        let $currentDate = $('<p></p>').attr('class', 'tweet-time').text(fullDate + ', ');

        let $currentUserTweet = $('<p></p>').attr('class', 'sorted-tweet-list-li').css('background-color', colorObj[tweet.user]).text(tweet.user + ': ' + currentTweet);

        $currentDate.appendTo($containerDiv);
        $currentUserTweet.appendTo($containerDiv);
        $containerDiv.appendTo('#' + tweet.user + '-tweet-stack');

        //These lines limit the Sorted Timeline to the 5 most recent tweets.
        let $userTweetStackChildren = $('#' + tweet.user + '-tweet-stack').children();
        if ($userTweetStackChildren.length > 5) {
          $userTweetStackChildren.eq($userTweetStackChildren.length - 1).remove();
        }
      }

      //Makes links clickable-
      $('a').on('click', function() {
        //First Tests if the event.target.innerHTML is a handle or hashtag...
        let aTest = event.target.innerHTML.split('');
        //For Hashtags...
        if (aTest[0] === '#') {
          aTest = aTest.splice(1)
          aTest = aTest.join('');
          $('.hashtag-name-declarations').removeClass('js-is-displayed');
          $('.' + aTest).addClass('js-is-displayed');
          $('#hashtag-sorted-title').text('-- #' + aTest + ' --');
          $('.hashtag-tweets-container').addClass('js-is-displayed');
          return;
        }
        //For Handles
        let userHandle = (event.target.innerHTML);
        userHandle = userHandle.split('');
        //Removes Colon...
        userHandle = userHandle.splice(0, userHandle.length - 2).join('');

        $('.sortedNameDeclarations').removeClass('js-is-displayed');
        $('.' + userHandle).addClass('js-is-displayed');
        $('#sorted-title').text('-- ' + userHandle + '\'s Sorted Timeline --').css({'color': '#FFFFFF', 'background-color': colorObj[userHandle]})

        $('.sorted-timeline').addClass('js-is-displayed');

        //Alpha Transparent Background!
        let alphaColor = colorObj[userHandle].split('');
        alphaColor.splice(alphaColor.length, 0, 'A6');
        alphaColor = alphaColor.join('');
        $('#sorted-timeline').css({'background-color': alphaColor});

      })
}).attr('class', 'one-more-tweet-button').appendTo($tweetTimeline);


      colorCoding();

      //Sorted Section-----------
      const $sortedTweetsContainer = $('<div></div>').attr({'id': 'sorted-timeline', 'class': 'section-container sorted-timeline'});

      let $title = $('<h3></h3>').text('Sorted').addClass('js-is-underlined').attr({'class': 'section-title', 'id': 'sorted-title'}).appendTo($sortedTweetsContainer);

      for(let key in streams.users){
        let $currentSortedTweetDeck = $('<div></div>').attr({'class': 'sortedNameDeclarations ' + key});

        $($currentSortedTweetDeck).appendTo($sortedTweetsContainer);

        //Tweeters Name
        //these lines add the names:
        let $currentTweetStack = $('<div></div>').attr({'id': key + '-tweet-stack', 'class': 'current-tweet-stack'});
        $currentTweetStack.appendTo($currentSortedTweetDeck);


        //------------------------

        //These lines add the tweets:
        for (let i = 0; i < streams.users[key].length; i++) {
          let tweet = streams.users[key][i];
          //Handling the Time
          let fullDate = dateHandler(tweet.created_at);

          let currentTweet = tweet.message;
          let containerDiv = $('<div></div>').attr('class', 'sorted-individual-tweet-container')
          let $currentUserTime = $('<p></p>').attr('class', 'tweet-time').text(fullDate + ', ').appendTo(containerDiv);
          let $currentUserTweet = $('<p></p>').attr('class', 'sorted-tweet-list-li').css('background-color', colorObj[tweet.user]).text(currentTweet).addClass('js-is-italicized').appendTo(containerDiv);

          if (i === 0) {
            $($currentUserTweet).addClass('js-is-bolded')
          }
          containerDiv.appendTo($currentTweetStack);
        }
        //-------------------------
      }

      $sortedTweetsContainer.appendTo($body)

      //Makes links clickable-
      $('a').on('click', function() {
        //First Tests if the event.target.innerHTML is a handle or hashtag...
        let aTest = event.target.innerHTML.split('');
        //For Hashtags...
        if (aTest[0] === '#') {
          aTest = aTest.splice(1)
          aTest = aTest.join('');
          $('.hashtag-name-declarations').removeClass('js-is-displayed');
          $('.' + aTest).addClass('js-is-displayed');
          $('#hashtag-sorted-title').text('-- #' + aTest + ' --');
          $('.hashtag-tweets-container').addClass('js-is-displayed');
          return;
        }
        //For Handles
        let userHandle = (event.target.innerHTML);
        userHandle = userHandle.split('');
        userHandle = userHandle.splice(0, userHandle.length - 2).join('');

        $('.sortedNameDeclarations').removeClass('js-is-displayed');
        $('.' + userHandle).addClass('js-is-displayed');
        $('#sorted-title').text('-- ' + userHandle + '\'s Sorted Timeline --').css({'color': '#FFFFFF', 'background-color': colorObj[userHandle]})

        $('.sorted-timeline').addClass('js-is-displayed');

        //Alpha Transparent Background!
        let alphaColor = colorObj[userHandle].split('');
        alphaColor.splice(alphaColor.length, 0, 'A6');
        alphaColor = alphaColor.join('');
        $('#sorted-timeline').css({'background-color': alphaColor});
      });

      //Hashtag Section-
      const $hashtagTweetsContainer = $('<div></div>').attr({'id': 'hashtag-timeline', 'class': 'section-container hashtag-tweets-container'}).appendTo('body');


      let $hashTagtitle = $('<h3></h3>').text('Hashtags Sorted').addClass('js-is-underlined').attr({'class': 'section-title', 'id': 'hashtag-sorted-title'}).appendTo($hashtagTweetsContainer);

      //This for loop creates hashtag containers
    for (let i = 0; i < tags.length; i++) {

      //Removing the hash for the id & class...
      let hashCheck = tags[i].split('');
      if (hashCheck[0] === '#') {
        hashCheck.shift()
        hashCheck = hashCheck.join('');
        let $currentSortedHashtagDeck = $('<div></div>').attr('class','hashtag-name-declarations ' + hashCheck).appendTo($hashtagTweetsContainer);

        let $currentHashTagStack = $('<div></div>').attr({'id': hashCheck + '-hashtag-stack', 'class': 'current-hashtag-stack'}).appendTo($currentSortedHashtagDeck);


        for (let j = 0; j < streams.home.length; j++) {
          let checkTag = streams.home[j].message;
          checkTag = checkTag.split('');
          if (checkTag.indexOf('#') !== -1) {
            checkTag = checkTag.splice(checkTag.indexOf('#')).join('')

          if ('#' + hashCheck === checkTag) {
            //Container that holds time & tweet.
            let $containerDiv = $('<div></div>').attr('class', 'sorted-individual-tag-container');
            //Time
            $('<p></p>').text(dateHandler(streams.home[j].created_at)).attr('class', 'tweet-time').appendTo($containerDiv);
            //Tweet
            $('<p></p>').attr('class', 'sorted-tag-list-li').text(streams.home[j].user + ': ' + streams.home[j].message).appendTo($containerDiv);
            $containerDiv.appendTo($currentHashTagStack);
          }
        }
      }
    }
  }
});
    </script>
  </body>
</html>
